{"mappings":"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","sources":["src/socket-script.js","src/main.js"],"sourcesContent":["export default function () {\r\n  const messagecontainer = document.getElementById('message-container');\r\n  const messageForm = document.getElementById('send-container');\r\n  const messgaeInput = document.getElementById('message-input');\r\n\r\n  let user_name;\r\n  let last_other_color;\r\n  let last_message;\r\n\r\n  let isReading = false;\r\n\r\n  while (true) {\r\n    try {\r\n      user_name = prompt('What is your name?').trim();\r\n\r\n      if (user_name.length != 0) {\r\n        user_name = user_name.substring(0, 10);\r\n        break;\r\n      }\r\n    } catch (error) {\r\n      console.log(`이름을 작성해주세요`);\r\n    }\r\n  }\r\n\r\n  var socket = io({\r\n    reconnection: false,\r\n  });\r\n  socket.emit('new-user', user_name);\r\n  appendMessage({ message: `${user_name} joined` }, 'info');\r\n\r\n  socket.on('chat-message', (data) => {\r\n    appendMessage(data, 'other');\r\n  });\r\n\r\n  socket.on('user-connected', (uname) => {\r\n    appendMessage({ message: `${uname} connected` }, 'info');\r\n  });\r\n\r\n  socket.on('user-disconnected', (uname) => {\r\n    appendMessage({ message: `${uname} disconnected` }, 'info');\r\n  });\r\n\r\n  socket.on('disconnect', () => {\r\n    disconnecting();\r\n  });\r\n\r\n  socket.on('bye', () => {\r\n    disconnecting();\r\n  });\r\n\r\n  function disconnecting() {\r\n    appendMessage({ message: `disconnected` }, 'info');\r\n\r\n    // message_form disabled\r\n    messgaeInput.value = '';\r\n    messgaeInput.disabled = true;\r\n    document.querySelector('#send-button').disabled = true;\r\n  }\r\n\r\n  messageForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const message = messgaeInput.value.trim();\r\n\r\n    if (message.length == 0) {\r\n      return;\r\n    }\r\n\r\n    appendMessage({ message: message });\r\n\r\n    socket.emit('send-chat-message', message);\r\n    messgaeInput.value = '';\r\n\r\n    init();\r\n    document.querySelector('#message-input').focus();\r\n  });\r\n\r\n  function appendMessage(data, type = 'me') {\r\n    let { message, name, color } = data;\r\n    if (!name) {\r\n      name = 'unknown';\r\n    }\r\n    const messageElement = document.createElement('div');\r\n    let msg, time;\r\n    let textNode = document.createTextNode(message);\r\n\r\n    switch (type) {\r\n      case 'me':\r\n        messageElement.className = type;\r\n\r\n        msg = document.createElement('div');\r\n        msg.className = 'msg';\r\n        msg.appendChild(textNode);\r\n\r\n        time = document.createElement('div');\r\n        time.className = 'time';\r\n        time.innerHTML = getChatTime();\r\n\r\n        messageElement.appendChild(msg);\r\n        messageElement.appendChild(time);\r\n\r\n        if (last_message?.className == 'me') {\r\n          setVisibilityTime(last_message, time);\r\n        }\r\n\r\n        last_other_color = '';\r\n        last_message = messageElement;\r\n        break;\r\n      case 'other':\r\n        messageElement.className = type;\r\n        const profileimg = document.createElement('div');\r\n        profileimg.className = 'profileimg';\r\n        profileimg.innerHTML = name[0].toUpperCase();\r\n        profileimg.style.backgroundColor = color;\r\n        profileimg.style.color = getColorByBgColor(color);\r\n\r\n        const namentime = document.createElement('div');\r\n        namentime.className = 'namentime';\r\n\r\n        const uname = document.createElement('div');\r\n        uname.className = 'uname';\r\n\r\n        uname.appendChild(document.createTextNode(name));\r\n\r\n        msg = document.createElement('div');\r\n        msg.className = 'msg';\r\n        msg.appendChild(textNode);\r\n\r\n        time = document.createElement('div');\r\n        time.className = 'time';\r\n        time.innerHTML = getChatTime();\r\n\r\n        if (last_other_color != color) {\r\n          messageElement.appendChild(profileimg);\r\n          namentime.appendChild(uname);\r\n        } else {\r\n          setVisibilityTime(last_message, time);\r\n        }\r\n\r\n        namentime.appendChild(msg);\r\n        namentime.appendChild(time);\r\n\r\n        messageElement.appendChild(namentime);\r\n        last_other_color = color;\r\n\r\n        last_message = namentime;\r\n        break;\r\n\r\n      default:\r\n        messageElement.className = type;\r\n        messageElement.appendChild(textNode);\r\n        last_other_color = '';\r\n\r\n        setTimeout(() => {\r\n          getUserList();\r\n        }, 300);\r\n\r\n        break;\r\n    }\r\n\r\n    messagecontainer.append(messageElement);\r\n\r\n    if (!isReading) {\r\n      messagecontainer.scrollBy({\r\n        top: messagecontainer.scrollHeight,\r\n        behavior: 'smooth',\r\n      });\r\n    }\r\n  }\r\n\r\n  messgaeInput.addEventListener(\r\n    'input',\r\n    function () {\r\n      chkvalue(messgaeInput.value.trim());\r\n    },\r\n    false\r\n  );\r\n\r\n  Object.defineProperty(String.prototype, 'hashCode', {\r\n    value: function () {\r\n      var hash = 0,\r\n        i,\r\n        chr;\r\n      for (i = 0; i < this.length; i++) {\r\n        chr = this.charCodeAt(i);\r\n        hash = (hash << 5) - hash + chr;\r\n        hash |= 0;\r\n      }\r\n      return hash;\r\n    },\r\n  });\r\n\r\n  const listbox = document.querySelector('#user-list > ul');\r\n\r\n  function getChatTime() {\r\n    var today = new Date();\r\n    var h = today.getHours();\r\n    var m = today.getMinutes();\r\n    m = checkTime(m);\r\n\r\n    return `${h}:${m}`;\r\n  }\r\n\r\n  function checkTime(i) {\r\n    if (i < 10) {\r\n      i = '0' + i;\r\n    }\r\n    return i;\r\n  }\r\n\r\n  function getColorByName(name) {\r\n    const stringhash = `0.` + Math.abs(String(name).hashCode());\r\n\r\n    var bg_colour = Math.floor(Number(stringhash) * 16777215).toString(16);\r\n    bg_colour = '#' + ('000000' + bg_colour).slice(-6);\r\n\r\n    return bg_colour;\r\n  }\r\n\r\n  function getColorByBgColor(bgColor) {\r\n    if (!bgColor) {\r\n      return '';\r\n    }\r\n    return parseInt(bgColor.replace('#', ''), 16) > 0xffffff / 2\r\n      ? '#000000'\r\n      : '#ffffff';\r\n  }\r\n\r\n  function chkvalue(text) {\r\n    if (text.length == 0) {\r\n      document.querySelector('#send-button').style.color = '#9e9e9e';\r\n    } else {\r\n      document.querySelector('#send-button').style.color = '';\r\n    }\r\n  }\r\n\r\n  function setVisibilityTime(parentElement, time) {\r\n    let time_element;\r\n\r\n    for (var i = 0; i < parentElement.childNodes.length; i++) {\r\n      if (parentElement.childNodes[i].className == 'time') {\r\n        time_element = parentElement.childNodes[i];\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (time_element?.innerHTML == time.innerHTML) {\r\n      time_element.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  function getUserList() {\r\n    //   listbox 초기화\r\n    let newListbox = document.createElement('li');\r\n    newListbox.innerHTML = `<li class=\"list-group-item head\">User List</li>`;\r\n\r\n    const url = '/users';\r\n    const fetchResponsePromise = fetch(url);\r\n    fetchResponsePromise\r\n      .then((response) => {\r\n        if (response.status === 200) {\r\n          return response.json();\r\n        } else {\r\n          throw new Error('Something went wrong on api server!');\r\n        }\r\n      })\r\n      .then((response) => {\r\n        console.log(`fetch`, response);\r\n        let i = 0;\r\n        for (const key in response) {\r\n          i++;\r\n          if (response.hasOwnProperty(key)) {\r\n            const element = response[key];\r\n\r\n            const new_li_element = document.createElement('li');\r\n            new_li_element.className = 'list-group-item';\r\n            new_li_element.appendChild(document.createTextNode(element));\r\n            newListbox.appendChild(new_li_element);\r\n          }\r\n        }\r\n        listbox.innerHTML = newListbox.innerHTML;\r\n      })\r\n      .catch((error) => {\r\n        console.error(error);\r\n      });\r\n  }\r\n\r\n  function init() {\r\n    document.querySelector('#send-button').style.color = '#9e9e9e';\r\n  }\r\n\r\n  init();\r\n\r\n  // 스크롤 위치에 따라 isReading 값 토글\r\n  messagecontainer.addEventListener('scroll', function (e) {\r\n    const { offsetHeight, scrollTop, scrollHeight } = e.target;\r\n    // console.info(offsetHeight + scrollTop, scrollHeight);\r\n    if (!isReading && scrollHeight - (offsetHeight + scrollTop) >= 60) {\r\n      isReading = true;\r\n      // console.info(isReading);\r\n    } else if (isReading && scrollHeight - (offsetHeight + scrollTop) < 60) {\r\n      isReading = false;\r\n      // console.info(isReading);\r\n    }\r\n  });\r\n}\r\n","import socket_script from './socket-script';\r\n\r\nsocket_script();\r\n"],"names":["messagecontainer","document","getElementById","messageForm","messgaeInput","user_name","last_other_color","last_message","isReading","prompt","trim","length","substring","error","console","log","socket","io","reconnection","disconnecting","appendMessage","message","value","disabled","querySelector","data","type","name","color","messageElement","createElement","msg","time","textNode","createTextNode","className","appendChild","innerHTML","getChatTime","setVisibilityTime","profileimg","toUpperCase","style","backgroundColor","bgColor","parseInt","replace","namentime","uname","setTimeout","newListbox","fetch","then","response","status","json","Error","key","hasOwnProperty","element","new_li_element","listbox","catch","getUserList","append","scrollBy","top","scrollHeight","behavior","emit","on","addEventListener","e","preventDefault","init","focus","Object","defineProperty","String","prototype","i","hash","this","charCodeAt","today","Date","h","getHours","m","getMinutes","checkTime","parentElement","time_element","childNodes","display","offsetHeight","scrollTop","target","$91f7bdef4205e60b$export$9099ad97b570f7c"],"version":3,"file":"index.06c81f88.js.map"}